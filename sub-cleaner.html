<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Subtitle Tool ‚Äî –Ω–æ–º–µ—Ä–∞ + —Ç–∞–π–º–∏–Ω–≥–∏ ‚Üî —Ç–µ–∫—Å—Ç</title>
  <style>
    *{box-sizing:border-box}
    
    :root {
      --bg-color: #fff;
      --text-color: #000;
      --section-bg: #fff;
      --input-bg: #fff;
      --input-border: #ccc;
      --button-bg: #f0f0f0;
      --button-hover: #e0e0e0;
      --button-text: #000;
      --error-color: crimson;
    }
    
    [data-theme="dark"] {
      --bg-color: #1a1a1a;
      --text-color: #e0e0e0;
      --section-bg: #1a1a1a;
      --input-bg: #2a2a2a;
      --input-border: #444;
      --button-bg: #3a3a3a;
      --button-hover: #4a4a4a;
      --button-text: #e0e0e0;
      --error-color: #ff6b6b;
    }
    
    body{
      font-family:Arial, sans-serif;
      margin:0;
      padding:20px;
      background: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    .container {
      display: flex;
      gap: 24px;
    }
    
    section{
      flex:1;
      display:flex;
      flex-direction:column;
      background: var(--section-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    
    h2{margin:0 0 12px;font-size:20px}
    label{margin-top:12px;font-weight:600}
    
    textarea{
      width:100%;
      height:300px;
      resize:vertical;
      margin-top:4px;
      padding:8px;
      background: var(--input-bg);
      color: var(--text-color);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      transition: background 0.3s ease, border-color 0.3s ease;
    }
    
    button{
      margin-top:12px;
      padding:8px 14px;
      font-size:14px;
      cursor:pointer;
      background: var(--button-bg);
      color: var(--button-text);
      border: 1px solid var(--input-border);
      border-radius: 4px;
      transition: background 0.3s ease;
    }
    
    button:hover{
      background: var(--button-hover);
    }
    
    #error{color:var(--error-color);margin-top:8px}
    
    .theme-toggle {
      position: fixed;
      top: 25px;
      right: 40px;
      background: var(--button-bg);
      border: 1px solid var(--input-border);
      border-radius: 50px;
      padding: 8px 16px;
      cursor: pointer;
      color: var(--text-color);
      font-size: 16px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1000;
    }
    
    .theme-toggle:hover {
      background: var(--button-hover);
      transform: scale(1.05);
    }
    
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      
      .theme-toggle {
        top: 10px;
        right: 10px;
        padding: 6px 12px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

<button class="theme-toggle" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
  <span id="themeIcon">üåô</span>
  <span id="themeText">–¢—ë–º–Ω–∞—è</span>
</button>

<div class="container">
  <!-- ============  –§–£–ù–ö–¶–ò–Ø 1  ============ -->
  <section id="strip">
  <h2>–§—É–Ω–∫—Ü–∏—è 1 ‚Äî —É–±—Ä–∞—Ç—å —Ç–∞–π–º–∏–Ω–≥–∏</h2>

  <label for="inputSrt">–°—É–±—Ç–∏—Ç—Ä—ã (SRT)</label>
  <textarea id="inputSrt" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π .srt"></textarea>

  <button id="stripBtn">–£–¥–∞–ª–∏—Ç—å —Ç–∞–π–º–∏–Ω–≥–∏ ‚Üí</button>

  <label for="outputText">–†–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–æ–º–µ—Ä + —Ç–µ–∫—Å—Ç)</label>
  <textarea id="outputText" readonly></textarea>
</section>

<!-- ============  –§–£–ù–ö–¶–ò–Ø 2  ============ -->
<section id="merge">
  <h2>–§—É–Ω–∫—Ü–∏—è 2 ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∏–Ω–≥–∏</h2>

  <label for="inputPlain">–°—É–±—Ç–∏—Ç—Ä—ã –±–µ–∑ —Ç–∞–π–º–∏–Ω–≥–æ–≤</label>
  <textarea id="inputPlain"
            placeholder="–ö–∞–∂–¥—ã–π –±–ª–æ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω–æ–º–µ—Ä–∞, –∑–∞—Ç–µ–º –ª—é–±—ã–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ–∫—Å—Ç–∞ (–≤–∫–ª—é—á–∞—è –ø—É—Å—Ç—ã–µ) –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –Ω–æ–º–µ—Ä–∞"></textarea>

  <button id="mergeBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∏–Ω–≥–∏ ‚Üí</button>

  <label for="outputSrt">–†–µ–∑—É–ª—å—Ç–∞—Ç (SRT)</label>
  <textarea id="outputSrt" readonly></textarea>
  <div id="error"></div>
  </section>
</div>

<script>
/* –ú–∞—Å—Å–∏–≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤: { num, timing, text } */
let storedBlocks = [];

/* ---------- –†–∞–∑–±–æ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ SRT (–§-—Ü–∏—è 1) ---------- */
function parseSrtBlocks(raw){
  return raw.trim()
    .split(/\r?\n\r?\n/)        // –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ = –Ω–æ–≤—ã–π –±–ª–æ–∫
    .map(b=>{
      const lines=b.split(/\r?\n/);
      if(lines.length<3) return null;
      return{
        num:    lines[0].trim(),
        timing: lines[1].trim(),
        text:   lines.slice(2).join('\n').trim()   // —Ç–µ–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è
      };
    })
    .filter(Boolean);
}

/* ---------- –†–∞–∑–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–Ω–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º) ---------- */
function parseTypedBlocks(raw){
  const lines = raw.split(/\r?\n/);
  const blocks = [];
  let current = null;

  lines.forEach(line=>{
    const trimmed = line.trim();

    /* –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ ‚Äî —á–∏—Å—Ç—ã–π –Ω–æ–º–µ—Ä */
    if(/^\d+$/.test(trimmed)){
      if(current) blocks.push(current);
      current = { num: trimmed, textLines: [] };
      return;
    }

    if(current){
      /* –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ */
      if(trimmed!==''){
        current.textLines.push(trimmed);
      }
    }
  });

  if(current) blocks.push(current);

  /* –°–æ–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç—Ä–æ–∫ */
  return blocks.map(b=>({
    num:  b.num,
    text: b.textLines.join('\n').trim() || '‚Äã'     // zero-width NBSP –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –ø—É—Å—Ç—ã—Ö
  }));
}

/* ---------- –§–£–ù–ö–¶–ò–Ø 1 ---------- */
document.getElementById('stripBtn').addEventListener('click',()=>{
  const raw = document.getElementById('inputSrt').value;
  if(!raw.trim()) return;

  storedBlocks = parseSrtBlocks(raw);
  if(!storedBlocks.length){
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –±–ª–æ–∫–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤.');
    return;
  }

  /* –í—ã–≤–æ–¥: –Ω–æ–º–µ—Ä ‚Üµ —Ç–µ–∫—Å—Ç, –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ */
  document.getElementById('outputText').value =
    storedBlocks.map(b=>`${b.num}\n${b.text}`).join('\n\n');
});

/* ---------- –§–£–ù–ö–¶–ò–Ø 2 ---------- */
document.getElementById('mergeBtn').addEventListener('click',()=>{
  const rawUser = document.getElementById('inputPlain').value.trim();
  const errorEl = document.getElementById('error');

  if(!storedBlocks.length){
    errorEl.textContent='–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é 1, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–π–º–∏–Ω–≥–∏.';
    return;
  }

  const typedBlocks = parseTypedBlocks(rawUser);

  if(typedBlocks.length!==storedBlocks.length){
    errorEl.textContent=
      `–ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: –±–ª–æ–∫–æ–≤ —Ç–µ–∫—Å—Ç–∞ ${typedBlocks.length}, —Ç–∞–π–º–∏–Ω–≥–æ–≤ ${storedBlocks.length}.`;
    return;
  }
  errorEl.textContent='';

  /* –°–±–æ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ SRT */
  const srt = typedBlocks.map((b,idx)=>
    `${b.num}\n${storedBlocks[idx].timing}\n${b.text}\n`
  ).join('\n');

  document.getElementById('outputSrt').value = srt;
});
</script>

<script>
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');
  const themeText = document.getElementById('themeText');
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –∏ —Ç–µ–∫—Å—Ç–∞
  function updateThemeUI(theme) {
    if (theme === 'dark') {
      themeIcon.textContent = '‚òÄÔ∏è';
      themeText.textContent = '–°–≤–µ—Ç–ª–∞—è';
    } else {
      themeIcon.textContent = 'üåô';
      themeText.textContent = '–¢—ë–º–Ω–∞—è';
    }
  }
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  updateThemeUI(savedTheme);
  
  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
  themeToggle.addEventListener('click', () => {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeUI(newTheme);
  });
</script>

</body>
</html>
